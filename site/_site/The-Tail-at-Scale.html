<!DOCTYPE html>
<html lang="en-us">
  
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      The Tail at Scale &middot; Papers I Read
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://shagunsodhani.github.io/papers-I-read/public/css/poole.css">
  <link rel="stylesheet" href="https://shagunsodhani.github.io/papers-I-read/public/css/syntax.css">
  <link rel="stylesheet" href="https://shagunsodhani.github.io/papers-I-read/public/css/lanyon.css">
  <link rel="stylesheet" href="https://shagunsodhani.github.io/papers-I-read/public/css/style.css">
  <link rel="stylesheet" href="https://shagunsodhani.github.io/papers-I-read/public/font-awesome-4.7.0/css/font-awesome.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://shagunsodhani.github.io/papers-I-read/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="https://shagunsodhani.github.io/papers-I-read/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-68140113-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-68140113-4');
</script>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>I am trying a new initiative - <i>A Paper A Week</i>. This blog will hold all the notes and summaries.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://shagunsodhani.github.io/papers-I-read/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="https://shagunsodhani.github.io/papers-I-read/archieve">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="https://shagunsodhani.github.io/papers-I-read/tags">Tags</a>
        
      
    

    <!-- <a class="sidebar-nav-item" href="https://github.com/shagunsodhani/papers-I-read/archive/v1.0.0.zip">Download</a> -->
    <a class="sidebar-nav-item" href="https://github.com/shagunsodhani/papers-I-read">GitHub project</a>
    <a class="sidebar-nav-item" href="https://shagunsodhani.github.io/papers-I-read/atom.xml">Feed</a>
    <!-- <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://shagunsodhani.github.io/papers-I-read/" title="Home">Papers I Read</a>
            <small>Notes and Summaries</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">The Tail at Scale</h1>
  <p class="entry-tags"><a href="https://shagunsodhani.github.io/papers-I-read/tags.html#2013" title="Pages tagged 2013" rel="tag">2013</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#Distributed+Systems" title="Pages tagged Distributed Systems" rel="tag">Distributed Systems</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#ACM" title="Pages tagged ACM" rel="tag">ACM</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#Engineering" title="Pages tagged Engineering" rel="tag">Engineering</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#Latency" title="Pages tagged Latency" rel="tag">Latency</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#Scale" title="Pages tagged Scale" rel="tag">Scale</a> &bull; <a href="https://shagunsodhani.github.io/papers-I-read/tags.html#Systems" title="Pages tagged Systems" rel="tag">Systems</a></p>
  <span class="post-date">15 Mar 2021</span>
  <h2 id="introduction">Introduction</h2>

<ul>
  <li>
    <p>The paper presents some causes for (temporary) high-latency episodes in large-scale online systems and techniques to mitigate their impact so that the tail of latency distribution remains short.</p>
  </li>
  <li>
    <p><a href="https://research.google/pubs/pub40801/">Link to the paper</a></p>
  </li>
</ul>

<h2 id="why-does-variability-in-response-time-exist">Why does variability in response time exist</h2>

<ul>
  <li>
    <p>Shared resources between processes on the same node</p>
  </li>
  <li>
    <p>Background processes (daemons) could use cause a momentary spike in resource usage.</p>
  </li>
  <li>
    <p>Processes running on different nodes may contend for global resources like shared file systems.</p>
  </li>
  <li>
    <p>Maintenance activities like disk compaction or garbage collection.</p>
  </li>
  <li>
    <p>Others like queueing, power limits, or energy management.</p>
  </li>
  <li>
    <p>In the case of large-scale systems, the component-level variability is further amplified.</p>
  </li>
</ul>

<h2 id="reducing-component-variability">Reducing Component Variability</h2>

<ul>
  <li>
    <p>Use differentiated service classes to prioritize user requests over non-interactive requests.</p>
  </li>
  <li>
    <p>Reduce head-of-line blocking by breaking long-running requests into smaller requests.</p>
  </li>
  <li>
    <p>Synchronize maintenance jobs across nodes to minimize the window for high latency.</p>
  </li>
  <li>
    <p>Caching generally does not help to address tail latency.</p>
  </li>
</ul>

<h2 id="adapting-to-latency-variability">Adapting to Latency Variability</h2>

<ul>
  <li>
    <p>Two categories of adaptation approaches</p>

    <ul>
      <li>
        <p>Within Request Short-Term Adaptations</p>

        <ul>
          <li>
            <p>These approaches are more relevant for services that perform many read queries on loosely consistent datasets.</p>
          </li>
          <li>
            <p>Hedged Request</p>

            <ul>
              <li>
                <p>Send the request to multiple replicas, and once one of the replicas returns the result, cancel the other requests.</p>
              </li>
              <li>
                <p>In practice, start by sending the request to only one replica. Send the secondary requests if the first request is outstanding for more than $95^{th}$ percentile of expected latency.</p>
              </li>
              <li>
                <p>This introduces an additional $5\%$ load while substantially shortening the latency tail.</p>
              </li>
              <li>
                <p>This approach work because often, the cause of latency is not the query itself but other factors like overloaded nodes.</p>
              </li>
            </ul>
          </li>
          <li>
            <p>Tied Request</p>

            <ul>
              <li>
                <p>Hedged request approach makes a tradeoff regarding how long to wait before initiating requests to other replicas. The sooner the request is made, the lower should be the latency in serving the request, but more will be the overall load in the system.</p>
              </li>
              <li>
                <p>The load in the system can be reduced by “tieing” requests (sent to different replicas) so that as soon as one replica starts processing the request, it can notify the other replicas, which could drop the request or deprioritize it.</p>
              </li>
              <li>
                <p>In practice, “tieing” requests means that each replica has the identity of other replicas which may execute the request.</p>
              </li>
              <li>
                <p>Note that there is a short window (of the average network message delay) when multiple replicas could start executing the request. This can be mitigated if the client (issuing the requests) introduces a delay to twice the average network message delay.</p>
              </li>
            </ul>
          </li>
          <li>
            <p>Submit the request to the least loaded replica</p>

            <ul>
              <li>This is less effective for reasons like the load on a replica can change after the request is made but before it is executed.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <p>Cross-Request Long-Term Adaptations</p>

        <ul>
          <li>
            <p>These approaches are more relevant for situations where different services have different throughput.</p>
          </li>
          <li>
            <p>Micro-partitions</p>

            <ul>
              <li>
                <p>Generate more paritions than the number of nodes.</p>
              </li>
              <li>
                <p>The partitions can be dynamically assigned to machines to ensure proper load balancing.</p>
              </li>
              <li>
                <p>In case of machine failure, many nodes can be used to quickly re-create the micro-partitions instead of waiting on one machine to read one single large partition.</p>
              </li>
            </ul>
          </li>
          <li>
            <p>Selective Replication</p>

            <ul>
              <li>With micro-partitioning, replicas for micro-partitions can be created ahead of time to achieve good load balancing.</li>
            </ul>
          </li>
          <li>
            <p>Latency induced probation</p>

            <ul>
              <li>In some cases, removing a slow node can improve the overall latency of the system. The probated node can be re-incorporated when its latency improves.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Large Information Retrieval Systems</p>

    <ul>
      <li>
        <p>In such systems, speed can be more critical than the quality of the result.</p>
      </li>
      <li>
        <p>The system should return a “good enough” result that is available with low latency instead of waiting for the “best result” that is available with high latency.</p>
      </li>
      <li>
        <p>In some cases, a request could trigger an unexpected code path or cause some other exception that could slow down the entire system.</p>
      </li>
      <li>
        <p>In such cases, the <em>canary request</em> technique can be used where the system sends the request initially to only 1 or 2 nodes. The request is sent over to the other nodes only after receiving a successful response from the initial nodes.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Requests that update state are easier to handle for several reasons:</p>

    <ul>
      <li>
        <p>The scale of latency-critical modifications is generally small.</p>
      </li>
      <li>
        <p>The update can be performed asynchronously after responding to the user.</p>
      </li>
      <li>
        <p>Quorum-based approaches (often used for ensuring consistent updates) are inherently tail-tolerant.</p>
      </li>
    </ul>
  </li>
</ul>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="https://shagunsodhani.github.io/papers-I-read/Toolformer-Language-Models-Can-Teach-Themselves-to-Use-Tools">
            Toolformer - Language Models Can Teach Themselves to Use Tools
            <small>10 Feb 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="https://shagunsodhani.github.io/papers-I-read/Synthesized-Policies-for-Transfer-and-Adaptation-across-Tasks-and-Environments">
            Synthesized Policies for Transfer and Adaptation across Tasks and Environments
            <small>29 Mar 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="https://shagunsodhani.github.io/papers-I-read/Deep-Neural-Networks-for-YouTube-Recommendations">
            Deep Neural Networks for YouTube Recommendations
            <small>22 Mar 2021</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://shagunsodhani.github.io/papers-I-read/The-Tail-at-Scale"  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/The-Tail-at-Scale"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://papers-i-read.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

  </body>
</html>
